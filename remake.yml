packages:
  - yaml
  - dplyr
  - geoknife
  - lubridate
  - rgdal
  - XML
  - doMC
  - foreach
  
## All R files that are used must be listed here:
sources:
  - scripts/loadConfig.R
  - scripts/load_config.R
  - scripts/lake_summary_locations.R
  - scripts/lake_summary_nldas.R
  - scripts/get_raw_nldas_nc.R
  - scripts/post_notaro_thredds.R

include:
  - remake_wqp.yml

targets:
  ## 'all' is a special target that will be used as the default
  ## target by 'remake'.  It doesn't actually make anything but
  ## "depends" on other targets.
  all:
    depends: 
      - data/nldas_lakes.txt
      - data/NLDAS_sub/NLDAS_sub_status.txt
      - data/NLDAS_data/NLDAS_driver_status.txt
      - data/ECHAM5_data/ECHAM5_driver_status.txt
      - data/GENMOM_data/GENMOM_driver_status.txt
      - data/CM2.0_data/CM2.0_driver_status.txt
      - data/ACCESS_data/ACCESS_driver_status.txt
      - nldas_index
      - cm2.0_index
      - genmom_index
      - echam5_index
      - access_index

  #data/nldas_lakes.txt:
  #  command: lake_summary_nldas(project_lake_locations, nldas_config)

  data/NLDAS_sub/nldas_miwimn.ncml:
    command: create_nldas_ncml("data/NLDAS_sub/NLDAS_file_list.tsv")

  project_lake_locations:
    command: lake_summary_locations()
    depends: 
      - ncml 
      - access_ncml
      - data/depth_data/depth_data_summary.csv

  data/NLDAS_sub/NLDAS_file_list.tsv:
    command: calc_nldas_files(nldas_config, nhd_config) 

  data/NLDAS_sub/NLDAS_sub_status.txt:
    command: nccopy_nldas()
    depends: 
      - data/NLDAS_sub/NLDAS_file_list.tsv

  nldas_config:
    command: load_config("configs/NLDAS_config.yml")

  nhd_config:
    command: load_config("configs/NHD_config.yml")

  echam5_config:
    command: load_config("configs/ECHAM5_config.yml")

  cm2.0_config:
    command: load_config("configs/CM2.0_config.yml")

  genmom_config:
    command: load_config("configs/GENMOM_config.yml")

  access_config:
    command: load_config("configs/ACCESS_config.yml")

  data/NLDAS_summ/NLDAS_driver_index.tsv:
    command: driver_server_files('data/NLDAS_data/NLDAS_driver_status.txt')

  data/GENMOM_summ/GENMOM_driver_index.tsv:
    command: driver_server_files('data/GENMOM_data/GENMOM_driver_status.txt')

  data/CM2.0_summ/CM2.0_driver_index.tsv:
    command: driver_server_files('data/CM2.0_data/CM2.0_driver_status.txt')

  data/ECHAM5_summ/ECHAM5_driver_index.tsv:
    command: driver_server_files('data/ECHAM5_data/ECHAM5_driver_status.txt')

  data/ACCESS_summ/ACCESS_driver_index.tsv:
    command: driver_server_files('data/ACCESS_data/ACCESS_driver_status.txt')

  ncml:
    command: sync_ncml("data/NLDAS_sub/nldas_miwimn.ncml")

  access_ncml:
    command: sync_notaro_ncml("data/ACCESS_sub/access_miwimn.ncml")

  cnrm_ncml:
    command: sync_notaro_ncml("data/CNRM_sub/cnrm_miwimn.ncml")

  gfdl_ncml:
    command: sync_notaro_ncml("data/GFDL_sub/gfdl_miwimn.ncml")

  ipsl_ncml:
    command: sync_notaro_ncml("data/IPSL_sub/ipsl_miwimn.ncml")

  miroc5_ncml:
    command: sync_notaro_ncml("data/MIROC5_sub/miroc5_miwimn.ncml")

  mri_ncml:
    command: sync_notaro_ncml("data/MRI_sub/mri_miwimn.ncml")

  nhd_states:
    command: write_nhd_shp(nhd_config)

  data/ACCESS_data/ACCESS_driver_file_list.tsv:
    command: calc_nldas_driver_files(access_config, project_lake_locations)

  data/NLDAS_data/NLDAS_driver_file_list.tsv:
    command: calc_nldas_driver_files(nldas_config, project_lake_locations)

  data/ECHAM5_data/ECHAM5_driver_file_list.tsv:
    command: calc_nldas_driver_files(echam5_config, project_lake_locations)

  data/GENMOM_data/GENMOM_driver_file_list.tsv:
    command: calc_nldas_driver_files(genmom_config, project_lake_locations)

  data/CM2.0_data/CM2.0_driver_file_list.tsv:
    command: calc_nldas_driver_files(cm2.0_config, project_lake_locations)

  data/NLDAS_data/NLDAS_driver_status.txt:
    command: lake_driver_nldas("data/NLDAS_data/NLDAS_driver_file_list.tsv")

  data/GENMOM_data/GENMOM_driver_status.txt:
    command: lake_driver_nldas("data/GENMOM_data/GENMOM_driver_file_list.tsv")

  data/ECHAM5_data/ECHAM5_driver_status.txt:
    command: lake_driver_nldas("data/ECHAM5_data/ECHAM5_driver_file_list.tsv")

  data/CM2.0_data/CM2.0_driver_status.txt:
    command: lake_driver_nldas("data/CM2.0_data/CM2.0_driver_file_list.tsv")

  data/ACCESS_data/ACCESS_driver_status.txt:
    command: lake_driver_nldas("data/ACCESS_data/ACCESS_driver_file_list.tsv")

  nldas_index:
    command: sync_driver_index("data/NLDAS_summ/NLDAS_driver_index.tsv")

  echam5_index:
    command: sync_driver_index("data/ECHAM5_summ/ECHAM5_driver_index.tsv")

  genmom_index:
    command: sync_driver_index("data/GENMOM_summ/GENMOM_driver_index.tsv")

  cm2.0_index:
    command: sync_driver_index("data/CM2.0_summ/CM2.0_driver_index.tsv")

  access_index:
    command: sync_driver_index("data/ACCESS_summ/ACCESS_driver_index.tsv")

